s3 key="AKIAJMUYVYOSACNXLPTQ" secret="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"

path {
	"uri"			"#{path}"
	"hash"			"#{input_digest}.#{image_mime_extension}"
	"hash-name"		"#{input_digest}/#{image_name}.#{image_mime_extension}"
	"structured"		"#{dirname}/#{input_digest}/#{basename}.#{image_mime_extension}"
	"structured-name"	"#{dirname}/#{input_digest}/#{basename}-#{image_name}.#{image_mime_extension}"
}

put "thumbnail" ":name_list" {
	thumbnail "input" {
		"original"	operation="limit"	width=1080	height=1080	format="jpeg"	quality=95
		"small"		operation="crop"	width=128	height=128	format="jpeg"	if-image-name-on="#{name_list}"
		"padded"	operation="pad"		width=128	height=128	format="jpeg"	background-color="gray" if-image-name-on="#{name_list}"
	}

	store_s3 "input"	bucket="httpimagestoretest"		path="hash"		cache-control="public, max-age=31557600, s-maxage=0" public=true
	store_s3 "original"	bucket="httpimagestoretest-originals"	path="hash"
	store_s3 "small"	bucket="httpimagestoretest"		path="hash-name"	cache-control="public, max-age=31557600, s-maxage=0" public=true if-image-name-on="#{name_list}"
	store_s3 "padded"	bucket="httpimagestoretest"		path="hash-name"	cache-control="public, max-age=31557600, s-maxage=0" public=true if-image-name-on="#{name_list}"

	output_store_url {
		"input"
		"small"		if-image-name-on="#{name_list}"
		"padded"	if-image-name-on="#{name_list}"
	}
}

post "original" {
	thumbnail "input" {
		"original"	operation="limit"	width=1080	height=1080	format="jpeg"	quality=95
	}

	store_s3 "original"	bucket="rhoriginals" path="hash"

	output_store_path	"original"
}

get "thumbnail" "v1" ":operation" ":width" ":height" ":options" {
	source_s3 "original" bucket="rhoriginals" path="uri"

	thumbnail "original" {
		"thumbnail"	operation="#{operation}" width="#{width}" height="#{height}" options="#{options}" quality=84 format="jpeg"
	}

	output_image "thumbnail" cache-control="public, max-age=31557600, s-maxage=0"
}


s3 key="AKIAJMUYVYOSACNXLPTQ" secret="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"

path {
	"uri"				"#{path}"
	"hash"				"#{digest}.#{extension}"
	"hash-name"			"#{digest}/#{name}.#{extension}"
	"structured"		"#{dirname}/#{digest}/#{basename}.#{extension}"
	"structured-name"	"#{dirname}/#{digest}/#{basename}-#{name}.#{extension}"
}

put "thumbnail" ":name_list" {
	thumbnail "input" {
		"original"	operation="limit"	width=1080	height=1080	format="jpeg"	quality=95
		"small"		operation="crop"	width=128	height=128	format="jpeg"							if_name_on="#{name_list}"
		"padded"	operation="pad"		width=128	height=128	format="jpeg"	background-color="gray" if_name_on="#{name_list}"
	}

	store_s3 {
		"input"		bucket="rhthumbnails"	path="structured"		cache-control="max-age=31557600, s-maxage=0"
		"original"	bucket="rhoriginals"	path="hash"
		"small"		bucket="rhthumbnails"	path="structured-name"	cache-control="max-age=31557600, s-maxage=0" if_name_on="#{name_list}"
		"padded"	bucket="rhthumbnails"	path="structured-name"	cache-control="max-age=31557600, s-maxage=0" if_name_on="#{name_list}"
	}

	output_store_url {
		"input"
		"small"		if_name_on="#{name_list}"
		"padded"	if_name_on="#{name_list}"
	}
}

post "original" {
	thumbnail "input" {
		"original"	operation="limit"	width=1080	height=1080	format="jpeg"	quality=95
	}

	store_s3 "original"	bucket="rhoriginals" path="hash"

	output_store_path	"original"
}

get "thumbnail" "v1" ":operation" ":width" ":height" ":options" {
	source_s3 "original" bucket="rhoriginals" path="uri"

	thumbnail "original" {
		"thumbnail"	operation="#{operation}" width="#{width}" hegith="#{height}" options="#{options}" quality=84 format="jpeg"
	}

	output_image "thumbnail" cache-control="max-age=31557600, s-maxage=0"
}

